# 典型要素

* 主客転倒
* 畳み込み

# 解法

ある要素のペアに着目し、最終結果への寄与を考える。`B[j] - B[i] = x` であるとき, `1 <= x <= n-1` ならば、`j - i = x` であるような並び方 `(n-x) * (n-2)!` 通りのそれぞれで `S[x]` が総和に加えられる。したがって、`k = 1 ... n-1` それぞれについて、`B[j] - B[i] = k` となる組の数が分かれば良い。

これは、愚直に計算するとO(N^2)になるが、畳み込みでO(NlogN)で計算できる。XをBのヒストグラムとし、Xを前後反転させたものをYとする。XとYの畳み込みをZとすると、`Z[n-i] = Σ (j=1..n-i) X[j] * X[j+i]`となり、`B[k] - B[j] = i`となる組の数が分かる。

# 備考

ヒストグラムを考えることで畳み込みを利用する事ができた。
